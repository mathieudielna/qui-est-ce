{% extends 'basev2.html.twig' %}

{% block stylesheets %}
	<style type="text/css">
    </style>
{% endblock %}

{% block headertitle %}
   Qualité
{% endblock %}	
{% block headercreate %}
{% endblock %}

{% block body %}
	<div class="wrapper wrapper-content animated fadeIn">
		<div class="row">
	        <div class="col-lg-12">
				<div class="tabs-container">
	                <ul class="nav nav-tabs" role="tablist">
		                <li><a class="nav-link active show" data-toggle="tab" href="#tab-cartographie"> Cartographie des processus</a></li>
	                    <li><a class="nav-link" data-toggle="tab" href="#tab-objectif"> Objectifs et indicateurs</a></li>
	                </ul>
	                <div class="tab-content">
	                    <div role="tabpanel" id="tab-cartographie" class="tab-pane active show">
	                        <div class="panel-body">
		                        <div class="row">
									<div class="col-lg-12">
										<div class="row">
											<div class="col-lg-12">
												<div class="ibox ">
													<div class="ibox-title">
														<h5>CARTOGRAPHIE DES PROCESSUS</h5>
														<div class="ibox-tools">
															<a class="fullscreen-link">
																<i class="fa fa-expand"></i>
															</a>
														</div>
													</div>
													<div class="ibox-content">
														<div class="card-columns">
														{% for processus in allprocessuses if processus.typeprocessus.code is defined and processus.typeprocessus.code == "MAN" %}
															<div class="sortable">
																<!--Panel-->
																<div class="card" style="padding: 2px;">
																	<div class="card-body" style="padding: 15px;">
																		{% if processus.typeprocessus.code is defined %}
																			
																			<div class="row">
																				<div class="col-2">
																					<h2>
																						<a href="{{path('processus_edit',{'id' : processus.id} ) }}" class=" 
																						{% if processus.typeprocessus.code is defined and processus.typeprocessus.code == "MAN" %}
																						text-glaucous
																						{% elseif processus.typeprocessus.code is defined and processus.typeprocessus.code == "REA" %}
																						text-midnight
																						{% elseif processus.typeprocessus.code is defined and processus.typeprocessus.code == "SUP" %}
																						text-flirt
																						{% endif %}"><strong>{{ processus.code | default("N/C") }}</strong>	
																						</a>
																					</h2>
																				</div>
																				<div class="col-10">
																					{{ processus.metier.designation| default("") }}
																					<h2>
																						<a href="{{path('processus_edit',{'id' : processus.id} ) }}" class=" 
																						{% if processus.typeprocessus.code is defined and processus.typeprocessus.code == "MAN" %}
																						text-glaucous
																						{% elseif processus.typeprocessus.code is defined and processus.typeprocessus.code == "REA" %}
																						text-midnight
																						{% elseif processus.typeprocessus.code is defined and processus.typeprocessus.code == "SUP" %}
																						text-flirt
																						{% endif %}"><strong>{{ processus.designation | default("N/C") }}</strong>	
																						</a>
																					</h2>
																					{% if processus.finalite %}
																						{{ processus.finalite | default("") }}
																						<br>
																					{% endif %}
																					
																					
																					{% if processus.risques|length > 0 %}<span class="badge badge-danger"><small>{{ processus.risques|length | default("") }} risque{% if processus.risques|length > 1  %}s{% endif %}</small></span>{% endif %}
																					{% if processus.actions|length > 0 %}<span class="badge badge-info"><small>{{ processus.actions|length | default("") }} action{% if processus.actions|length > 1  %}s{% endif %}</small></span>{% endif %}
																					
																				</div>
																			</div>
																			
																			<div class="hr-line-dashed"></div>
																														
																			<div class="card-columns card-columns2">
																			{% for activite in allactivites if activite.processus.id is defined and activite.processus.id == processus.id %}
																				<div class="sortable">
																					<div class="card btn 
																					{% if processus.typeprocessus.code is defined and processus.typeprocessus.code == "MAN" %}
																					glaucous-bg
																					{% elseif processus.typeprocessus.code is defined and processus.typeprocessus.code == "REA" %}
																					midnight-bg
																					{% elseif processus.typeprocessus.code is defined and processus.typeprocessus.code == "SUP" %}
																					flirt-bg
																					{% endif %} text-left" style="padding: 0px;">
																						<div class="card-body" style="padding: 8px;">
																							<a href="{{path('activite_edit',{'id' : activite.id} ) }}" class="text-white"><strong>{{ activite.designation | default("N/C") }}</strong></a>
																						</div>						
																					</div>
																				</div>
																			{% endfor %}
																			</div>
													
																		{% endif %}

																		<div class="hr-line-dashed"></div>

																		<div class="row">
																			<div class="col-lg-6">
																				<ul>
																				{% set count = 0 %}
																				{% for activite in allactivites if activite.processus.id is defined and activite.processus.id == processus.id %}
																					{% for fluxConnectActivite in activite.fluxConnectActivites if fluxConnectActivite.flux.objetmetiers is defined and fluxConnectActivite.flux.objetmetiers is not null %}
																						{% if fluxConnectActivite.flux.objetmetiers and fluxConnectActivite.direction.code is defined and fluxConnectActivite.direction.code is not null and fluxConnectActivite.direction.code == 1 %}
																						{% set count = count + 1 %}
																						{% endif %}
																					{% endfor %}
																				{% endfor %}
																				{% if count >=1 %}<h4>Données d'entrée</h4>{% endif %}
																				{% set handledOm = [] %}
																				{% for activite in allactivites if activite.processus.id is defined and activite.processus.id == processus.id %}
																					{% for fluxConnectActivite in activite.fluxConnectActivites if fluxConnectActivite.flux.objetmetiers is defined and fluxConnectActivite.flux.objetmetiers is not null  %}
																						{% for om in fluxConnectActivite.flux.objetmetiers if fluxConnectActivite.direction.code is defined and fluxConnectActivite.direction.code is not null and fluxConnectActivite.direction.code == 1 and om not in handledOm %}
																							{% for o in fluxConnectActivite.flux.objetmetiers if o.id == om.id and o not in handledOm %}
																								{% set handledOm = handledOm|merge([o]) %}
																								<small>
																									<li>
																										{{ om.designation }}
																									</li>
																								</small>
																							{% endfor %}
																						{% endfor %}
																					{% endfor %}
																				{% endfor %}
																				</ul>
																			</div>
																			<div class="col-lg-6">
																				<ul>
																				{% set count = 0 %}
																				{% for activite in allactivites if activite.processus.id is defined and activite.processus.id == processus.id %}
																					{% for fluxConnectActivite in activite.fluxConnectActivites if fluxConnectActivite.flux.objetmetiers is defined and fluxConnectActivite.flux.objetmetiers is not null  %}
																						{% if fluxConnectActivite.flux.objetmetiers and fluxConnectActivite.direction.code is defined and fluxConnectActivite.direction.code is not null and fluxConnectActivite.direction.code == 2 %}
																						{% set count = count + 1 %}
																						{% endif %}
																					{% endfor %}
																				{% endfor %}
																				{% if count >=1 %}<h4>Données de sortie</h4>{% endif %}
																				{% set handledOm = [] %}
																				{% for activite in allactivites if activite.processus.id is defined and activite.processus.id == processus.id %}
																					{% for fluxConnectActivite in activite.fluxConnectActivites if fluxConnectActivite.flux.objetmetiers is defined and fluxConnectActivite.flux.objetmetiers is not null  %}
																						{% for om in fluxConnectActivite.flux.objetmetiers if fluxConnectActivite.direction.code is defined and fluxConnectActivite.direction.code is not null and fluxConnectActivite.direction.code == 2 and om not in handledOm %}
																							{% for o in fluxConnectActivite.flux.objetmetiers if o.id == om.id and o not in handledOm %}
																								{% set handledOm = handledOm|merge([o]) %}
																								<small>
																									<li>
																									{{ om.designation }}
																									</li>
																								</small>
																							{% endfor %}
																						{% endfor %}
																					{% endfor %}
																				{% endfor %}
																				</ul>
																			</div>
																		</div>
																	</div>
																</div>
																<!--/.Panel-->
															</div>
														{% endfor %}
														</div>
														<div class="card-columns">
														{% for processus in allprocessuses if processus.typeprocessus.code is defined and processus.typeprocessus.code == "REA" %}
															<div class="sortable">
																<!--Panel-->
																<div class="card" style="padding: 2px;">
																	<div class="card-body" style="padding: 15px;">
																		{% if processus.typeprocessus.code is defined %}
																			
																			<div class="row">
																				<div class="col-2">
																					<h2>
																						<a href="{{path('processus_edit',{'id' : processus.id} ) }}" class=" 
																						{% if processus.typeprocessus.code is defined and processus.typeprocessus.code == "MAN" %}
																						text-glaucous
																						{% elseif processus.typeprocessus.code is defined and processus.typeprocessus.code == "REA" %}
																						text-midnight
																						{% elseif processus.typeprocessus.code is defined and processus.typeprocessus.code == "SUP" %}
																						text-flirt
																						{% endif %}"><strong>{{ processus.code | default("N/C") }}</strong>	
																						</a>
																					</h2>
																				</div>
																				<div class="col-10">
																					{{ processus.metier.designation| default("") }}
																					<h2>
																						<a href="{{path('processus_edit',{'id' : processus.id} ) }}" class=" 
																						{% if processus.typeprocessus.code is defined and processus.typeprocessus.code == "MAN" %}
																						text-glaucous
																						{% elseif processus.typeprocessus.code is defined and processus.typeprocessus.code == "REA" %}
																						text-midnight
																						{% elseif processus.typeprocessus.code is defined and processus.typeprocessus.code == "SUP" %}
																						text-flirt
																						{% endif %}"><strong>{{ processus.designation | default("N/C") }}</strong>	
																						</a>
																					</h2>
																					{% if processus.finalite %}
																						{{ processus.finalite | default("") }}
																						<br>
																					{% endif %}
																					
																					
																					{% if processus.risques|length > 0 %}<span class="badge badge-danger"><small>{{ processus.risques|length | default("") }} risque{% if processus.risques|length > 1  %}s{% endif %}</small></span>{% endif %}
																					{% if processus.actions|length > 0 %}<span class="badge badge-info"><small>{{ processus.actions|length | default("") }} action{% if processus.actions|length > 1  %}s{% endif %}</small></span>{% endif %}
																					
																				</div>
																			</div>
																			
																			<div class="hr-line-dashed"></div>
																														
																			<div class="card-columns card-columns2">
																			{% for activite in allactivites if activite.processus.id is defined and activite.processus.id == processus.id %}
																				<div class="sortable">
																					<div class="card btn 
																					{% if processus.typeprocessus.code is defined and processus.typeprocessus.code == "MAN" %}
																					glaucous-bg
																					{% elseif processus.typeprocessus.code is defined and processus.typeprocessus.code == "REA" %}
																					midnight-bg
																					{% elseif processus.typeprocessus.code is defined and processus.typeprocessus.code == "SUP" %}
																					flirt-bg
																					{% endif %} text-left" style="padding: 0px;">
																						<div class="card-body" style="padding: 8px;">
																							<a href="{{path('activite_edit',{'id' : activite.id} ) }}" class="text-white"><strong>{{ activite.designation | default("N/C") }}</strong></a>
																						</div>						
																					</div>
																				</div>
																			{% endfor %}
																			</div>
													
																		{% endif %}

																		<div class="hr-line-dashed"></div>

																		<div class="row">
																			<div class="col-lg-6">
																				<ul>
																				{% set count = 0 %}
																				{% for activite in allactivites if activite.processus.id is defined and activite.processus.id == processus.id %}
																					{% for fluxConnectActivite in activite.fluxConnectActivites if fluxConnectActivite.flux.objetmetiers is defined and fluxConnectActivite.flux.objetmetiers is not null  %}
																						{% if fluxConnectActivite.flux.objetmetiers and fluxConnectActivite.direction.code is defined and fluxConnectActivite.direction.code is not null and fluxConnectActivite.direction.code == 1 %}
																						{% set count = count + 1 %}
																						{% endif %}
																					{% endfor %}
																				{% endfor %}
																				{% if count >=1 %}<h4>Données d'entrée</h4>{% endif %}
																				{% set handledOm = [] %}
																				{% for activite in allactivites if activite.processus.id is defined and activite.processus.id == processus.id %}
																					{% for fluxConnectActivite in activite.fluxConnectActivites if fluxConnectActivite.flux.objetmetiers is defined and fluxConnectActivite.flux.objetmetiers is not null  %}
																						{% for om in fluxConnectActivite.flux.objetmetiers if fluxConnectActivite.direction.code is defined and fluxConnectActivite.direction.code is not null and fluxConnectActivite.direction.code == 1 and om not in handledOm %}
																							{% for o in fluxConnectActivite.flux.objetmetiers if o.id == om.id and o not in handledOm %}
																								{% set handledOm = handledOm|merge([o]) %}
																								<small>
																									<li>
																										{{ om.designation }}
																									</li>
																								</small>
																							{% endfor %}
																						{% endfor %}
																					{% endfor %}
																				{% endfor %}
																				</ul>
																			</div>
																			<div class="col-lg-6">
																				<ul>
																				{% set count = 0 %}
																				{% for activite in allactivites if activite.processus.id is defined and activite.processus.id == processus.id %}
																					{% for fluxConnectActivite in activite.fluxConnectActivites if fluxConnectActivite.flux.objetmetiers is defined and fluxConnectActivite.flux.objetmetiers is not null  %}
																						{% if fluxConnectActivite.flux.objetmetiers and fluxConnectActivite.direction.code is defined and fluxConnectActivite.direction.code is not null and fluxConnectActivite.direction.code == 2 %}
																						{% set count = count + 1 %}
																						{% endif %}
																					{% endfor %}
																				{% endfor %}
																				{% if count >=1 %}<h4>Données de sortie</h4>{% endif %}
																				{% set handledOm = [] %}
																				{% for activite in allactivites if activite.processus.id is defined and activite.processus.id == processus.id %}
																					{% for fluxConnectActivite in activite.fluxConnectActivites if fluxConnectActivite.flux.objetmetiers is defined and fluxConnectActivite.flux.objetmetiers is not null  %}
																						{% for om in fluxConnectActivite.flux.objetmetiers if fluxConnectActivite.direction.code is defined and fluxConnectActivite.direction.code is not null and fluxConnectActivite.direction.code == 2 and om not in handledOm %}
																							{% for o in fluxConnectActivite.flux.objetmetiers if o.id == om.id and o not in handledOm %}
																								{% set handledOm = handledOm|merge([o]) %}
																								<small>
																									<li>
																									{{ om.designation }}
																									</li>
																								</small>
																							{% endfor %}
																						{% endfor %}
																					{% endfor %}
																				{% endfor %}
																				</ul>
																			</div>
																		</div>
																	</div>
																</div>
																<!--/.Panel-->
															</div>
														{% endfor %}
														</div>
														
														<div class="card-columns">
														{% for processus in allprocessuses if processus.typeprocessus.code is defined and processus.typeprocessus.code == "SUP" %}
															<div class="sortable">
																<!--Panel-->
																<div class="card" style="padding: 2px;">
																	<div class="card-body" style="padding: 15px;">
																		{% if processus.typeprocessus.code is defined %}
																			
																			<div class="row">
																				<div class="col-2">
																					<h2>
																						<a href="{{path('processus_edit',{'id' : processus.id} ) }}" class=" 
																						{% if processus.typeprocessus.code is defined and processus.typeprocessus.code == "MAN" %}
																						text-glaucous
																						{% elseif processus.typeprocessus.code is defined and processus.typeprocessus.code == "REA" %}
																						text-midnight
																						{% elseif processus.typeprocessus.code is defined and processus.typeprocessus.code == "SUP" %}
																						text-flirt
																						{% endif %}"><strong>{{ processus.code | default("N/C") }}</strong>	
																						</a>
																					</h2>
																				</div>
																				<div class="col-10">
																					{{ processus.metier.designation| default("") }}
																					<h2>
																						<a href="{{path('processus_edit',{'id' : processus.id} ) }}" class=" 
																						{% if processus.typeprocessus.code is defined and processus.typeprocessus.code == "MAN" %}
																						text-glaucous
																						{% elseif processus.typeprocessus.code is defined and processus.typeprocessus.code == "REA" %}
																						text-midnight
																						{% elseif processus.typeprocessus.code is defined and processus.typeprocessus.code == "SUP" %}
																						text-flirt
																						{% endif %}"><strong>{{ processus.designation | default("N/C") }}</strong>	
																						</a>
																					</h2>
																					{% if processus.finalite %}
																						{{ processus.finalite | default("") }}
																						<br>
																					{% endif %}
																					
																					
																					{% if processus.risques|length > 0 %}<span class="badge badge-danger"><small>{{ processus.risques|length | default("") }} risque{% if processus.risques|length > 1  %}s{% endif %}</small></span>{% endif %}
																					{% if processus.actions|length > 0 %}<span class="badge badge-info"><small>{{ processus.actions|length | default("") }} action{% if processus.actions|length > 1  %}s{% endif %}</small></span>{% endif %}
																					
																				</div>
																			</div>
																			
																			<div class="hr-line-dashed"></div>
																														
																			<div class="card-columns card-columns2">
																			{% for activite in allactivites if activite.processus.id is defined and activite.processus.id == processus.id %}
																				<div class="sortable">
																					<div class="card btn 
																					{% if processus.typeprocessus.code is defined and processus.typeprocessus.code == "MAN" %}
																					glaucous-bg
																					{% elseif processus.typeprocessus.code is defined and processus.typeprocessus.code == "REA" %}
																					midnight-bg
																					{% elseif processus.typeprocessus.code is defined and processus.typeprocessus.code == "SUP" %}
																					flirt-bg
																					{% endif %} text-left" style="padding: 0px;">
																						<div class="card-body" style="padding: 8px;">
																							<a href="{{path('activite_edit',{'id' : activite.id} ) }}" class="text-white"><strong>{{ activite.designation | default("N/C") }}</strong></a>
																						</div>						
																					</div>
																				</div>
																			{% endfor %}
																			</div>
													
																		{% endif %}

																		<div class="hr-line-dashed"></div>

																		<div class="row">
																			<div class="col-lg-6">
																				<ul>
																				{% set count = 0 %}
																				{% for activite in allactivites if activite.processus.id is defined and activite.processus.id == processus.id %}
																					{% for fluxConnectActivite in activite.fluxConnectActivites if fluxConnectActivite.flux.objetmetiers is defined and fluxConnectActivite.flux.objetmetiers is not null  %}
																						{% if fluxConnectActivite.flux.objetmetiers and fluxConnectActivite.direction.code is defined and fluxConnectActivite.direction.code is not null and fluxConnectActivite.direction.code == 1 %}
																						{% set count = count + 1 %}
																						{% endif %}
																					{% endfor %}
																				{% endfor %}
																				{% if count >=1 %}<h4>Données d'entrée</h4>{% endif %}
																				{% set handledOm = [] %}
																				{% for activite in allactivites if activite.processus.id is defined and activite.processus.id == processus.id %}
																					{% for fluxConnectActivite in activite.fluxConnectActivites if fluxConnectActivite.flux.objetmetiers is defined and fluxConnectActivite.flux.objetmetiers is not null  %}
																						{% for om in fluxConnectActivite.flux.objetmetiers if fluxConnectActivite.direction.code is defined and fluxConnectActivite.direction.code is not null and fluxConnectActivite.direction.code == 1 and om not in handledOm %}
																							{% for o in fluxConnectActivite.flux.objetmetiers if o.id == om.id and o not in handledOm %}
																								{% set handledOm = handledOm|merge([o]) %}
																								<small>
																									<li>
																										{{ om.designation }}
																									</li>
																								</small>
																							{% endfor %}
																						{% endfor %}
																					{% endfor %}
																				{% endfor %}
																				</ul>
																			</div>
																			<div class="col-lg-6">
																				<ul>
																				{% set count = 0 %}
																				{% for activite in allactivites if activite.processus.id is defined and activite.processus.id == processus.id %}
																					{% for fluxConnectActivite in activite.fluxConnectActivites if fluxConnectActivite.flux.objetmetiers is defined and fluxConnectActivite.flux.objetmetiers is not null  %}
																						{% if fluxConnectActivite.flux.objetmetiers and fluxConnectActivite.direction.code is defined and fluxConnectActivite.direction.code is not null and fluxConnectActivite.direction.code == 2 %}
																						{% set count = count + 1 %}
																						{% endif %}
																					{% endfor %}
																				{% endfor %}
																				{% if count >=1 %}<h4>Données de sortie</h4>{% endif %}
																				{% set handledOm = [] %}
																				{% for activite in allactivites if activite.processus.id is defined and activite.processus.id == processus.id %}
																					{% for fluxConnectActivite in activite.fluxConnectActivites if fluxConnectActivite.flux.objetmetiers is defined and fluxConnectActivite.flux.objetmetiers is not null%}
																						{% for om in fluxConnectActivite.flux.objetmetiers if fluxConnectActivite.direction.code is defined and fluxConnectActivite.direction.code is not null and fluxConnectActivite.direction.code == 2 and om not in handledOm %}
																							{% for o in fluxConnectActivite.flux.objetmetiers if o.id == om.id and o not in handledOm %}
																								{% set handledOm = handledOm|merge([o]) %}
																								<small>
																									<li>
																									{{ om.designation }}
																									</li>
																								</small>
																							{% endfor %}
																						{% endfor %}
																					{% endfor %}
																				{% endfor %}
																				</ul>
																			</div>
																		</div>
																	</div>
																</div>
																<!--/.Panel-->
															</div>
														{% endfor %}
														</div>
														
													</div>
												</div>
											</div>	
										</div>
									</div>
								</div>
							</div>
	                    </div>
	                    <div role="tabpanel" id="tab-objectif" class="tab-pane">
	                        <div class="panel-body">
		                        <div class="row">
									<div class="col-lg-12">
										{{ include('datatable/objectiftable.html.twig', {r : app.request.get('_route'), rr : conformite }) }}
									</div>
								</div>
	                        </div>
	                    </div>
	                </div>
				</div>
	        </div>
	    </div>
	</div>
{% endblock %}


{% block javascripts %}
<script>
	$(document).ready(function(){
       
        });

        /// Save tab state
		if (location.hash) {
		  $('a[href=\'' + location.hash + '\']').tab('show');
		}
		var activeTab = localStorage.getItem('activeTab');
		if (activeTab) {
		  $('a[href="' + activeTab + '"]').tab('show');
		}
		
		$('body').on('click', 'a[data-toggle=\'tab\']', function (e) {
		  e.preventDefault()
		  var tab_name = this.getAttribute('href')
		  if (history.pushState) {
		    history.pushState(null, null, tab_name)
		  }
		  else {
		    location.hash = tab_name
		  }
		  localStorage.setItem('activeTab', tab_name)
		
		  $(this).tab('show');
		  return false;
		});
		$(window).on('popstate', function () {
		  var anchor = location.hash ||
		    $('a[data-toggle=\'tab\']').first().attr('href');
		  $('a[href=\'' + anchor + '\']').tab('show');
		});

</script>

    
{% endblock %}
