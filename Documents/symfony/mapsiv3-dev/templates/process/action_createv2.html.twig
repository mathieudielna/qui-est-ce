{% extends 'baseform.html.twig' %}

{% form_theme formAction _self %}

{% block body %}
	{{ form_start(formAction) }}
		<div class="row">
			<div class="col-lg-12">
				<div class="ibox" id="printed">
					<div class="ibox-content">
						<div class="row">
							<div class="col-lg-4">
								<h1>
								{% if not editMode %}
								Nouveau action
								{% else %}
								Action
								{% endif %}
								</h1>
							</div>
							<div class="col-lg-8">
								
								<span class="float-right">
									<a class="btn btn-white btn-sm noprint" onclick="leaveEntity('action')">Quitter</a>
									{% if is_granted('ROLE_ADMIN') or is_granted('ROLE_USER_EDITABLE')%}
										<button type='submit' class="btn btn-primary btn-sm noprint disab" data-id="{{ action.id }}" onclick="submitAjax({{ action.id | default("undefined") }},'action')">
										{% if editMode %}
										Enregistrer <span class="change-message">
										<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-cloud-arrow-up-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
											<path fill-rule="evenodd" d="M8 2a5.53 5.53 0 0 0-3.594 1.342c-.766.66-1.321 1.52-1.464 2.383C1.266 6.095 0 7.555 0 9.318 0 11.366 1.708 13 3.781 13h8.906C14.502 13 16 11.57 16 9.773c0-1.636-1.242-2.969-2.834-3.194C12.923 3.999 10.69 2 8 2zm2.354 5.146l-2-2a.5.5 0 0 0-.708 0l-2 2a.5.5 0 1 0 .708.708L7.5 6.707V10.5a.5.5 0 0 0 1 0V6.707l1.146 1.147a.5.5 0 0 0 .708-.708z"/>
										</svg>
										</span>
										{% else %}
										Ajouter
										{% endif %}
										</button>
										<span class="dropdown">
										<button class="btn btn-primary dropdown-toggle btn-sm" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
										</button>
										<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
											<a class="dropdown-item" href="" data-id="{{ action.id }}" onclick="deleteEntity({{ action.id | default("undefined") }},'action')">Supprimer</a>
											
										</div>
										</span>
									{% endif %}
								</span>
									
								
							</div>
						</div>
						
						<div class="row">
							
							<div class="col-lg-12">
								<div class="row">
									<div class="col-lg-12">
										<br>
										<div class="form-group row">
											<div class="col-sm-2"></div>
											<div class="col-sm-10">{{ form_widget(formAction.designation)}}</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-2 col-form-label text-sm-right"><strong></strong></label>
											<div class="col-sm-5">
												{{ form_widget(formAction.responsable)}}<small id="" class="form-text text-muted">Responsable</small>
												{{ form_widget(formAction.suppleant)}}<small id="" class="form-text text-muted">Suppléant</small>
											</div>
											<div class="col-sm-5">{{ form_widget(formAction.people)}}<small id="" class="form-text text-muted">Contributeurs</small></div>
											
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="row">
							<label class="col-sm-2 col-form-label text-sm-right"><strong></strong></label>
							<div class="col-sm-8 text-sm-left">
								<dd class="mb-1">{% for place in workflow_marked_places(action) %} <strong>{{ workflow_metadata(action, 'title', place)|lower ?: ''}}</strong>{% endfor %} le {{ action.validatedat | date("d M Y")  }} par {{ action.validator.firstname | default("n/c") }} </dd>
								{% set rolep = "" %}
								{% for people in action.people %}
									{% if people == app.user.people %}{% set rolep = "people" %}{% endif %}
								{% endfor %}
								{% set roles = "" %}{% if action.suppleant == app.user.people  %}{% set roles = "suppleant" %}{% set rolep = "people" %}{% endif %}
								{% set roler = "" %}{% if action.responsable == app.user.people or is_granted('ROLE_ADMIN')  %}{% set roler = "responsable" %}{% set roles = "suppleant" %}{% set rolep = "people" %}{% endif %}
								{% for transition in workflow_transitions(action) %}
									{% if workflow_can(action, transition.name) %}
										{% if workflow_metadata(action, 'role', transition) in [rolep, roles, roler] %}
											<a type="button" href="#" style="margin: 2px" class="ajaxWorkflow btn btn-{{ workflow_metadata(action, 'ambiance', transition)}} btn-xs adisab" data-id="{{ action.id }}" data-statewk="{{ transition.name }}" data-entite="action">
											{{ workflow_metadata(action, 'title', transition) ?: 'n-a'}}
											</a>
										{% endif %}
									{% endif %}
								{% else %}
									No actions available.
								{% endfor %}
							</div>
						</div>
						<br><br>
					
						<div class="row">
							<div class="col-lg-12">
								<div class="tabs-container">
									<ul class="nav nav-tabs">
										<li>
											<a class="nav-link active show" data-toggle="tab" href="#introduction"> 
												<span style="font-size: 18px;">
													<i class="fa fa-info-circle"></i>
												</span>
											</a>
										</li>
										{% if editMode %}
										<li>
											<a class="nav-link" data-toggle="tab" href="#docs"> 
												<span style="font-size: 18px;">
													<i class="fa fa-files-o"></i>
												</span>
											</a>
										</li>
										{% endif %}
										<li>
											<a class="nav-link" data-toggle="tab" href="#comment"> 
												<span style="font-size: 18px;">
													<i class="fa fa-pencil-square-o"></i>
												</span>
											</a>
										</li>
									</ul>
									
									<div class="tab-content">
										
										<div id="introduction" class="tab-pane active show">
											<div class="panel-body">
												<div class="row">	
													<div class="col-sm-12">
													
														<h2>Description</h2>

                                                        <div class="form-group row">
                                                            <label class="col-sm-2 col-form-label">{{ form_label(formAction.projet, 'Projet') }}</label>
                                                            <div class="col-sm-10">{{ form_widget(formAction.projet)}}</div>
                                                        </div>
                                                        
                                                        <div class="form-group row">
                                                            <label class="col-sm-2 col-form-label">{{ form_label(formAction.phase, 'Phase programme') }}</label>
                                                            <div class="col-sm-10">{{ form_widget(formAction.phase)}}</div>
                                                        </div>
                                                        
                                                        <div class="hr-line-dashed"></div>
										    
                                                        <div class="form-group  row">
                                                            <label class="col-sm-2 col-form-label">{{ form_label(formAction.description, 'Description') }}</label>
                                                            <div class="col-sm-10">{{ form_widget(formAction.description)}}</div>
                                                        </div>
                                                        
                                                        <div class="hr-line-dashed"></div>
                                                        
                                                        <div class="form-group  row">
                                                            <label class="col-sm-2 col-form-label">{{ form_label(formAction.reference, 'Référence interne') }}</label>
                                                            <div class="col-sm-10">{{ form_widget(formAction.reference)}}</div>
                                                        </div>
                                                        
                                                        <div class="hr-line-dashed"></div>
                                                        
                                                        <div class="form-group row"><label class="col-sm-2 col-form-label">Statut</label>
                                                            <div class="col-sm-10">
                                                                <div class="row">
                                                                    <div class="col-md-6"><span class="form-text m-b-none text-navy">{{ form_label(formAction.statutaction, 'Statut de l\'action') }}</span>{{ form_widget(formAction.statutaction)}}</div>
                                                                    <div class="col-md-6"><span class="form-text m-b-none text-navy">{{ form_label(formAction.priorite, 'Priorité') }}</span>{{ form_widget(formAction.priorite)}}</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                               
						
														
													</div>
													<div class="col-lg-12">
														<h2>Relations</h2>

                                                       

                                                        <div class="form-group row">
                                                            <label class="col-sm-2 col-form-label"><strong>Tâches</strong> <button type='button' id="add-tache" class="btn btn-outline-success btn-xs">+</button><br>
                                                            <small>
                                                            Définissez les tâches et jalon de cette action</small>
                                                            </label>
                                                                <div class="col-sm-10">{{ form_widget(formAction.jalonConnectActions) }}</div>
                                                        </div>

                                                         <div class="hr-line-dashed"></div>

                                                        <div class="form-group row">
                                                            <label class="col-sm-2 col-form-label">{{ form_label(formAction.typeconformite, 'Domaine de conformité') }}</label>
                                                            <div class="col-sm-10">{{ form_widget(formAction.typeconformite)}}</div>
                                                        </div>
                                                        
                                                        <div class="hr-line-dashed"></div>
                                                        
                                                        <div class="form-group row">
                                                            <label class="col-sm-2 col-form-label">{{ form_label(formAction.domaineprojet, 'Domaine projet') }}</label>
                                                            <div class="col-sm-10">{{ form_widget(formAction.domaineprojet)}}</div>
                                                        </div>
                                                        
                                                        <div class="hr-line-dashed"></div>
                                                        
                                                        <div class="form-group row"><label class="col-sm-2 col-form-label">Relations</label>
                                                            <div class="col-sm-10">
                                                                <div class="row">
                                                                    <div class="col-md-12"><span class="form-text m-b-none text-navy">Flux / Traitement</span>{{ form_widget(formAction.fluxes)}}</div>
                                                                    <div class="col-md-12"><span class="form-text m-b-none text-navy">Processus</span>{{ form_widget(formAction.processuses)}}</div>
                                                                    <div class="col-md-12"><span class="form-text m-b-none text-navy">Axes stratégiques</span>{{ form_widget(formAction.axes)}}</div>
                                                                    <div class="col-md-12"><span class="form-text m-b-none text-navy">Risques</span>{{ form_widget(formAction.risques)}}</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                        <div class="hr-line-dashed"></div>
                                                        
                                                        <div class="form-group row">
                                                            <label class="col-sm-2 col-form-label">{{ form_label(formAction.applications, 'Applications') }}</label>
                                                            <div class="col-sm-10">{{ form_widget(formAction.applications)}}</div>
                                                        </div>
                                                                                
                                                        <div class="hr-line-dashed"></div>
                                                        
                                                        <div class="form-group row">
                                                            <label class="col-sm-2 col-form-label">{{ form_label(formAction.sites, 'Site') }}</label>
                                                            <div class="col-sm-10">{{ form_widget(formAction.sites)}}</div>
                                                        </div>

                                                      

															
													</div>
												</div>
											</div>
										</div>
									

										{% if editMode %}
										<div id="docs" class="tab-pane">
											<div class="panel-body">
												<div class="row">
													<div class="col-md-12"><h3>Gestionnaire de fichiers</h3></div>
												</div>
												<br>			                                
												<div class="form-group row">				
													<div class="col-sm-12">
														<iframe id="myframe" src="{{ path('file_manager', {module:1, conf:'entry', tree:0, extra: {'customer':app.user.customer.id, 'customername':app.user.customer.designation,  'bigentity': 'Actions', 'entryprefix': 'ACT', 'entryid': action.id, 'entryname': action.designation}}) }}" width="100%" height="500" frameborder="0"></iframe>
													</div>
												</div>
											</div>
										</div>
										{% endif %}
										<div id="comment" class="tab-pane">
											<div class="panel-body">
												<div class="row">
													<div class="col-md-12"><h3>Notes</h3></div>
												</div>
												<br>			                                
												<div class="form-group row">				
													<div class="col-sm-12">
														{{ form_widget(formAction.commentaire)}}
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>						
					</div>
				</div>
			</div>
		</div>

    {{ form_end(formAction) }}
{% endblock %}

{% block _action_jalonConnectActions_widget %}
	{{ form_widget(form)}}
{% endblock %}

{% block _action_jalonConnectActions_entry_widget %}
	<div class="row" id="block_{{id}}">
		<div class="col-md-11">
			<div class="panel panel-default">
				<div class="panel-body">
					<div class="form-group  row">
						<label class="col-sm-2 col-form-label">{{ form_label(form.jalon, 'Désignation') }}</label>
						<div class="col-sm-5">{{ form_widget(form.jalon, { 'attr': {'class': 'VarDesignation'} })}}</div>
						<div class="col-sm-5">
							{{ form_widget(form.topjalon) }}<br>
							{{ form_widget(form.fini, { 'attr': {'class': 'VarJalFini', 'data-action':'show'} })}}
						</div>
					</div>
				
					
					<div class="hr-line-dashed"></div>
					
					<div class="form-group  row">
						<label class="col-sm-2 col-form-label">{{ form_label(form.description, 'Description') }}</label>
						<div class="col-sm-10">{{ form_widget(form.description)}}</div>
					</div>

					
					
		

					<div class="hr-line-dashed"></div>
					
					<div class="form-group row"><label class="col-sm-2 col-form-label">Tracking</label>
						<div class="col-sm-10">
							<div class="row">
								<div class="col-md-3"><span class="form-text m-b-none text-navy">Tendance</span>
									{{ form_widget(form.rag)}}
								</div>
								<div class="col-md-3"><span class="form-text m-b-none text-navy">Progression</span>
									{% if form.vars.value.fini is defined and form.vars.value.fini ==1 %}
									{{ form_widget(form.progression, { 'attr': {'class': 'VarProgression Off'} })}}
									{%else%}
									{{ form_widget(form.progression, { 'attr': {'class': 'VarProgression'} })}}
									{%endif%}
								</div>
								<div class="col-md-3"><span class="form-text m-b-none text-navy">Budget</span>
									{% if form.vars.value.fini is defined and form.vars.value.fini ==1 %}
									{{ form_widget(form.budget, { 'attr': {'class': 'VarBudget Off'} })}}
									{%else%}
									{{ form_widget(form.budget, { 'attr': {'class': 'VarBudget'} })}}
									{%endif%}
								</div>
								<div class="col-md-3"><span class="form-text m-b-none text-navy">J/H</span>
									{% if form.vars.value.fini is defined and form.vars.value.fini ==1 %}
									{{ form_widget(form.etp, { 'attr': {'class': 'VarEtp Off'} })}}
									{%else%}
									{{ form_widget(form.etp, { 'attr': {'class': 'VarEtp'} })}}
									{%endif%}
								</div>
							</div>
						</div>
					</div>

					<div class="hr-line-dashed"></div>
					
					<div class="form-group row"><label class="col-sm-2 col-form-label">Planification</label>
						<div class="col-sm-10">
							<div class="row">
								<div class="col-md-3"><span class="form-text m-b-none text-navy">Démarrage</span>
									{% if form.vars.value.fini is defined and form.vars.value.fini ==1 %}
									{{ form_widget(form.datedebut, { 'attr': {'class': 'VarDateDebut Off'} })}}
									{%else%}
									{{ form_widget(form.datedebut, { 'attr': {'class': 'VarDateDebut'} })}}
									{%endif%}
								</div>
								<div class="col-md-3"><span class="form-text m-b-none text-navy">Fin planifiée</span>
									{% if form.vars.value.fini is defined and form.vars.value.fini ==1 %}
									{{ form_widget(form.date, { 'attr': {'class': 'VarDateprevisionnelle Off'} })}}
									{%else%}
									{{ form_widget(form.date, { 'attr': {'class': 'VarDateprevisionnelle'} })}}
									{%endif%}
								</div>
								<div class="col-md-3"><span class="form-text m-b-none text-navy">Outlook</span>
									{% if form.vars.value.fini is defined and form.vars.value.fini ==1 %}
									{{ form_widget(form.daterevue, { 'attr': {'class': 'VarDateRevue Off'} })}}
									{%else%}
									{{ form_widget(form.daterevue, { 'attr': {'class': 'VarDateRevue'} })}}
									{%endif%}
								</div>
								<div class="col-md-3"><span class="form-text m-b-none text-navy">J/H</span>
									{% if form.vars.value.fini is defined and form.vars.value.fini ==1 %}
									{{ form_widget(form.datereelle, { 'attr': {'class': 'VarDateReelle On'} })}}
									{%else%}
									{{ form_widget(form.datereelle, { 'attr': {'class': 'VarDateReelle Off'} })}}
									{%endif%}
								</div>
							</div>
						</div>
					</div>	
				</div>
			</div>
		</div>
		<div class="col-md-1">
			{% if is_granted('ROLE_ADMIN') or is_granted('ROLE_USER_EDITABLE')%}
				<button type="button" data-action="delete" data-target="#block_{{id}}" id="del" class="btn btn-outline-secondary btn-sm"><i class="fa fa-trash"></i></button>
			{% endif %}
		</div>
	</div>
{% endblock %}

	
{% block javascripts %}

	<script>

	$(document).ready(function() {		
		
        
		


        
	});	


			
		
	</script>
	
{% endblock %}
	



