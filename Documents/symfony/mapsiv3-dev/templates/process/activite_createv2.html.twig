{% extends 'baseform.html.twig' %}

{% form_theme formActivite _self %}

{% block body %}
	{{ form_start(formActivite) }}
		<div class="row">
			<div class="col-lg-12">
				<div class="ibox" id="printed">
					<div class="ibox-content">
						<div class="row">
							<div class="col-lg-4">
								<h1>
								
								{% if not editMode %}
								Nouvelle activité
								{% else %}
								Activité 
								{% endif %}
								</h1>
							</div>
							<div class="col-lg-8">
								<span class="float-right">
								{{ include('mod/edit-buttons.html.twig', {entname : 'activite', entid : activite.id }) }}
									
								</span>
							</div>
						</div>
						
						<div class="row">
							
							<div class="col-lg-12">
							{% set erreur = "" %}
							{% if not formActivite.vars.valid %}
								{# Loop through every form item #}
								{% for child in formActivite.children %}
									{# Display the errors of the form item #}
									{%for error in child.vars.errors%}
										{% set erreur = "Des erreurs de saisie ne permettent pas l\'enregistrement de la fiche" %}
									{%endfor%}
								{%endfor%}
							{%endif%}
							{% if erreur is defined and erreur is not null and erreur != '' %}
								<div class='alert alert-danger' role='alert'>{{erreur  | default("") }}</div>
							{% endif %}
							
								<div class="row">
									<div class="col-lg-12">
										<br>
										<div class="form-group row">
											<div class="col-sm-2"></div>
											<div class="col-sm-10">{{ form_widget(formActivite.designation)}}</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-2 col-form-label text-sm-right"><strong></strong></label>
											<div class="col-sm-5">
												{{ form_widget(formActivite.responsable)}}<small id="" class="form-text text-muted">Responsable</small>
												{{ form_widget(formActivite.suppleant)}}<small id="" class="form-text text-muted">Suppléant</small>
												{{ form_widget(formActivite.redacteur)}}<small id="" class="form-text text-muted">Rédacteur</small>
											</div>
											<div class="col-sm-5">{{ form_widget(formActivite.peoples)}}<small id="" class="form-text text-muted">Contributeurs</small></div>
											
										</div>
										<div class="row">
											
											<label class="col-sm-2 col-form-label text-sm-right"><strong></strong></label>
											<div class="col-sm-8 text-sm-left">
												{{ include('mod/edit-workflow.html.twig', {ent : activite, entname : 'activite', entid : activite.id }) }}
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<br><br>
					
						<div class="row">
							<div class="col-lg-12">
								<div class="tabs-container">
									<ul class="nav nav-tabs">
										<li>
											<a class="nav-link active show" data-toggle="tab" href="#introduction"> 
												<span style="font-size: 18px;">
													<i class="fa fa-info-circle"></i>
												</span>
											</a>
										</li>
										{% if editMode %}
										<li>
											<a class="nav-link" data-toggle="tab" href="#docs"> 
												<span style="font-size: 18px;">
													<i class="fa fa-files-o"></i>
												</span>
											</a>
										</li>
										{% endif %}
										<li>
											<a class="nav-link" data-toggle="tab" href="#comment"> 
												<span style="font-size: 18px;">
													<i class="fa fa-pencil-square-o"></i>
												</span>
											</a>
										</li>
									</ul>
									
									<div class="tab-content">
										
										<div id="introduction" class="tab-pane active show">
											<div class="panel-body">
												<div class="row">	
													<div class="col-sm-12">
													
														<h2>Description</h2>
                                                        <div class="form-group">
															{{ form_widget(formActivite.processus)}}
															<small id="" class="form-text text-muted">{{ form_label(formActivite.processus, 'Processus de rattachement') }}</small>
														</div>
														
										
														<div class="form-group">
															<span class="form-text m-b-none"></span>
															{{ form_widget(formActivite.description)}}
															<small id="" class="form-text text-muted">{{ form_label(formActivite.description, '') }}</small>
														</div>

													</div>
													<div class="col-lg-12">
														<h2>Relations</h2>
														<div class="row">
															<div class="col-lg-12">	
                                                                <div class="form-group">
																	<span class="form-text m-b-none">Quelles sont les tiers associés à cette activités ?</span>
																	{{ form_widget(formActivite.tiers)}}
																	<small id="" class="form-text text-muted">{{ form_label(formActivite.tiers, 'Tiers') }}</small>
																</div>
                                                                <div class="form-group">
																	<span class="form-text m-b-none">Quelles sont les ressources nécessaires et disponibles ?</span>
																	{{ form_widget(formActivite.ressources)}}
																	<small id="" class="form-text text-muted">{{ form_label(formActivite.ressources, 'Ressources') }}</small>
																</div>
                                                                <br>
                                                                <h2>Flux {% if is_granted('ROLE_ADMIN') or is_granted('ROLE_USER_EDITABLE')%}<span id="add-flux" class="btn btn-outline-primary btn-sm">+</span>{% endif %}</h2>
                                                                <div class="form-group row">                    
                                                                    <div class="col-sm-12">
                                                                        {{ form_widget(formActivite.fluxConnectActivites) }}
                                                                    </div>
                                                                </div>
                                                                
                                                                <br>

                                                                <h2>Applications {% if is_granted('ROLE_ADMIN') or is_granted('ROLE_USER_EDITABLE')%}<button type='button' id="add-app" class="btn btn-outline-primary btn-sm">+</button>{% endif %}</h2>
                                                                <div class="form-group row">
                                                        
                                                                    <div class="col-sm-12">
                                                                        {{ form_widget(formActivite.appConnectActivites) }}
                                                                    </div>
                                                                </div>
																

															</div>
														</div>	
													</div>
                                                    <div class="col-lg-12">
														<h2>Bilan d'impact sur activités</h2>
														<div class="row">
															<div class="col-lg-12">	
                                                                <div class="form-group row">
                                                                    <div class="col-sm-12">
                                                                        <div class="row">
                                                                            <div class="col-md-4">{{ form_widget(formActivite.dima1)}}<small id="" class="form-text text-muted">Délais d'interruption maximal admissible</small></div>
                                                                            <div class="col-md-4">{{ form_widget(formActivite.pdma1)}}<small id="" class="form-text text-muted">Perte de données maximale admissible</small></div>
                                                                            <div class="col-sm-4">{{ form_widget(formActivite.pca)}}<small id="" class="form-text text-muted">Intégration au plan de continuité des activités</small></div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="form-group row">
                                                                    <div class="col-md-12">{{ form_widget(formActivite.periodepic)}}<small id="" class="form-text text-muted">Quelles sont les périodes de pic d'activités ?</small></div>
                                                                </div>
                                                                 <div class="form-group row">
                                                                    <div class="col-md-12">{{ form_widget(formActivite.niveaureprise)}}<small id="" class="form-text text-muted">Quel est le niveau de reprise nécessaire en cas d'interruption ?</small></div>
                                                                </div>
                                                                <div class="form-group row">
                                                                    <div class="col-md-12">{{ form_widget(formActivite.perteca)}}<small id="" class="form-text text-muted">Evaluer le CA potentiellement perdu sur 1 mois</small></div>
                                                                </div>
                                                                <div class="form-group row">
                                                                    <div class="col-md-12">{{ form_widget(formActivite.perteactivite)}}<small id="" class="form-text text-muted">Evaluer le volume d'activités potentiellement perdu sur 1 mois</small></div>
                                                                </div>
                                                                <br>
                                                                <div class="form-group row">
                                                                    <label class="col-md-12"><h3>Les impacts d’un sinistre majeur sur les activités stratégiques.</h3></label>
                                                                    <div class="col-md-6">{{ form_widget(formActivite.impactimg)}}<small id="" class="form-text text-muted">{{ form_label(formActivite.impactimg, 'Evaluer l\'impact d\'un sinistre sur l\'image externe de l\'entreprise') }}</small></div>
                                                                    <div class="col-md-6">{{ form_widget(formActivite.impactactionnaire)}}<small id="" class="form-text text-muted">{{ form_label(formActivite.impactactionnaire, 'Evaluer l\'impact d\'un sinistre sur les partenaires et les actionnaires') }}</small></div>
                                                                    <div class="col-md-12">{{ form_widget(formActivite.perturbationexterne)}}<small id="" class="form-text text-muted">{{ form_label(formActivite.perturbationexterne, 'Perturbations externes') }}</small></div>
                                                                    <div class="col-md-6">{{ form_widget(formActivite.impactinterne)}}<small id="" class="form-text text-muted">{{ form_label(formActivite.impactinterne, 'Evaluer l\'impact d\'un sinistre sur le fonctionnement de l\'entreprise') }}</small></div>
                                                                    <div class="col-md-6">{{ form_widget(formActivite.impactcollaborateur)}}<small id="" class="form-text text-muted">{{ form_label(formActivite.impactcollaborateur, 'Evaluer l\'impact d\'un sinistre sur la motivation des collaborateurs') }}</small></div>
                                                                    <div class="col-md-6">{{ form_widget(formActivite.activitebusinessfutur)}}<small id="" class="form-text text-muted">{{ form_label(formActivite.activitebusinessfutur, 'Evaluer l\'impact d\'un sinistre sur les futures affaires') }}</small></div>
                                                                    <div class="col-md-12">{{ form_widget(formActivite.perturbationinterne)}}<small id="" class="form-text text-muted">{{ form_label(formActivite.perturbationinterne, 'Pertubations internes') }}</small></div>

                                                                </div>
                                                                <div class="form-group row">
                                                                    <label class="col-md-12"><h3>Les niveaux d'impact en fonction du temps d'arrêt</h3></label>
                                                                    <div class="col-md-6">{{ form_widget(formActivite.impact4h)}}<small id="" class="form-text text-muted">{{ form_label(formActivite.impact4h, '4 heures') }}</small></div>
                                                                    <div class="col-md-6">{{ form_widget(formActivite.impact1j)}}<small id="" class="form-text text-muted">{{ form_label(formActivite.impact1j, '1 jour') }}</small></div>
                                                                    <div class="col-md-6">{{ form_widget(formActivite.impact3j)}}<small id="" class="form-text text-muted">{{ form_label(formActivite.impact3j, '3 jours') }}</small></div>
                                                                    <div class="col-md-6">{{ form_widget(formActivite.impact1s)}}<small id="" class="form-text text-muted">{{ form_label(formActivite.impact1s, '1 semaine') }}</small></div>
                                                                    <div class="col-md-6">{{ form_widget(formActivite.impact2s)}}<small id="" class="form-text text-muted">{{ form_label(formActivite.impact2s, '2 semaines') }}</small></div>
                                                                    <div class="col-md-6">{{ form_widget(formActivite.impact1m)}}<small id="" class="form-text text-muted">{{ form_label(formActivite.impact1m, '1 mois') }}</small></div>
                                                                </div>
                                                                <div class="form-group row">
                                                                    <label class="col-md-12"><h3>Les conditions de mise en oeuvre du PCA</h3></label>
                                                                    <div class="col-md-6">{{ form_widget(formActivite.procedurepca)}}<small id="" class="form-text text-muted">{{ form_label(formActivite.procedurepca, 'Des procédures PCA sont elles disponibles ?') }}</small></div>
                                                                    <div class="col-md-12">{{ form_widget(formActivite.latencepca)}}<small id="" class="form-text text-muted">Quels sont les délais nécessaires au redémarrage ?</small></div>
                                                                    <div class="col-md-12">{{ form_widget(formActivite.traitementimmediat)}}<small id="" class="form-text text-muted">Quels sont les traitements à réaliser immédiatement ?</small></div>
                                                                    <div class="col-md-12">{{ form_widget(formActivite.conditionmaintien)}}<small id="" class="form-text text-muted">Quels conditions de fonctionnement sont requises ?</small></div>

                                                                </div>
															</div>
														</div>	
													</div>
												</div>
											</div>
										</div>
									

										{% if editMode %}
										<div id="docs" class="tab-pane">
											<div class="panel-body">
												<div class="row">
													<div class="col-md-12"><h3>Gestionnaire de fichiers</h3></div>
												</div>
												<br>			                                
												<div class="form-group row">				
													<div class="col-sm-12">
														<iframe id="myframe" src="{{ path('file_manager', {module:1, conf:'entry', tree:0, extra: {'customer':app.user.customer.id, 'customername':app.user.customer.designation,  'bigentity': 'Activités', 'entryprefix': 'A', 'entryid': activite.id, 'entryname': activite.designation}}) }}" width="100%" height="500" frameborder="0"></iframe>
													</div>
												</div>
											</div>
										</div>
										{% endif %}
										<div id="comment" class="tab-pane">
											<div class="panel-body">
												<div class="row">
													<div class="col-md-12"><h3>Notes</h3></div>
												</div>
												<br>			                                
												<div class="form-group row">				
													<div class="col-sm-12">
														{{ form_widget(formActivite.commentaire)}}
													</div>
												</div>
											</div>
										</div>

									</div>
								</div>
							</div>
						</div>						
					</div>
				</div>
			</div>
		</div>

    {{ form_end(formActivite) }}
{% endblock %}

{% block _activite_fluxConnectActivites_widget %}
	{{ form_widget(form)}}
{% endblock %}

{% block _activite_appConnectActivites_widget %}
	{{ form_widget(form)}}
{% endblock %}

{% block _activite_fluxConnectActivites_entry_widget %}
		<div class="row"  id="block_{{id}}">
            <div class="col-md-7">{{ form_widget(form.flux)}}</div>
			<div class="col-md-4">{{ form_widget(form.direction)}}</div>
            <div class="col-1">{% if is_granted('ROLE_ADMIN') or is_granted('ROLE_USER_EDITABLE')%}<button type="button" data-action="delete" data-target="#block_{{id}}" id="del-flux" class="btn btn-outline-secondary btn-sm"><i class="fa fa-trash"></i></button>{% endif %}</div>	
        </div>
{% endblock %}

{% block _activite_appConnectActivites_entry_widget %}
        <div class="row" id="block_{{id}}">
            <div class="col-md-7">{{ form_widget(form.application)}}</div>
            <div class="col-md-2">{{ form_widget(form.dima)}}</div>
            <div class="col-md-2">{{ form_widget(form.pdma)}}</div>
            <div class="col-1">{% if is_granted('ROLE_ADMIN') or is_granted('ROLE_USER_EDITABLE')%}<button type="button" data-action="delete" data-target="#block_{{id}}" id="del-flux" class="btn btn-outline-secondary btn-sm"><i class="fa fa-trash"></i></button>{% endif %}</div> 
        </div>
{% endblock %}





	
{% block javascripts %}

	<script>

	$(document).ready(function() {		
		
        
		


        
	});	
    


			
		
	</script>
	
{% endblock %}
	



