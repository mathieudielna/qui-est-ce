{% extends 'baseform.html.twig' %}

{% form_theme formSysteme _self %}

{% block body %}
	{{ form_start(formSysteme) }}
		<div class="row">
			<div class="col-lg-12">
				<div class="ibox" id="printed">
					<div class="ibox-content">
						<div class="row">
							<div class="col-lg-4">
								<h1>
								{% if not editMode %}
								Nouvelle systeme
								{% else %}
								Systeme
								{% endif %}
								</h1>
							</div>
							<div class="col-lg-8">
								
									<span class="float-right">
										<a class="btn btn-white btn-sm noprint" onclick="leaveEntity('systeme')">Quitter</a>
										{% if is_granted('ROLE_ADMIN') or is_granted('ROLE_USER_EDITABLE')%}
											<button type='submit' class="btn btn-primary btn-sm noprint disab" data-id="{{ systeme.id }}" onclick="deleteEntity({{ systeme.id | default("undefined") }},'systeme')">X</button>
											<button type='submit' class="btn btn-primary btn-sm noprint disab" data-id="{{ systeme.id }}" onclick="submitAjax({{ systeme.id | default("undefined") }},'systeme')">
											{% if editMode %}
											Enregistrer <span class="change-message">
											<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-cloud-arrow-up-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
												<path fill-rule="evenodd" d="M8 2a5.53 5.53 0 0 0-3.594 1.342c-.766.66-1.321 1.52-1.464 2.383C1.266 6.095 0 7.555 0 9.318 0 11.366 1.708 13 3.781 13h8.906C14.502 13 16 11.57 16 9.773c0-1.636-1.242-2.969-2.834-3.194C12.923 3.999 10.69 2 8 2zm2.354 5.146l-2-2a.5.5 0 0 0-.708 0l-2 2a.5.5 0 1 0 .708.708L7.5 6.707V10.5a.5.5 0 0 0 1 0V6.707l1.146 1.147a.5.5 0 0 0 .708-.708z"/>
											</svg>
											</span>
											{% else %}
											Ajouter
											{% endif %}
											</button>
										{% endif %}
									</span>
									
								
							</div>
						</div>
						
						<div class="row">
							
							<div class="col-lg-12">
								<div class="row">
									<div class="col-lg-12">
										<br>
										<div class="form-group row">
											<div class="col-sm-2"></div>
											<div class="col-sm-10">{{ form_widget(formSysteme.designation)}}</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-2 col-form-label text-sm-right"><strong></strong></label>
											<div class="col-sm-5">
												{{ form_widget(formSysteme.responsable)}}<small id="" class="form-text text-muted">Responsable</small>
												{{ form_widget(formSysteme.suppleant)}}<small id="" class="form-text text-muted">Suppléant</small>
												{# {{ form_widget(formSysteme.redacteur)}}<small id="" class="form-text text-muted">Rédacteur</small> #}
											</div>
											<div class="col-sm-5">{{ form_widget(formSysteme.peoples)}}<small id="" class="form-text text-muted">Contributeurs</small></div>
											
										</div>
								
										<div class="row">
											<label class="col-sm-2 col-form-label text-sm-right"><strong></strong></label>
											<div class="col-sm-10 align-middle">Maj le {{ systeme.publishedat | date("d M Y")  }} par {{ systeme.Publisher.firstname | default("n/c") }}</div>
										</div>
										<div class="row">
											<label class="col-sm-2 col-form-label text-sm-right"><strong></strong></label>
											<div class="col-sm-8 text-sm-left">
												<dd class="mb-1">{% for place in workflow_marked_places(systeme) %} <strong>{{ workflow_metadata(systeme, 'title', place)|lower ?: ''}}</strong>{% endfor %} le {{ systeme.validatedat | date("d M Y")  }} par {{ systeme.validator.firstname | default("n/c") }} </dd>
												{% set rolep = "" %}
												{% for people in systeme.peoples %}
													{% if people == app.user.people %}{% set rolep = "people" %}{% endif %}
												{% endfor %}
												{% set roles = "" %}{% if systeme.suppleant == app.user.people  %}{% set roles = "suppleant" %}{% set rolep = "people" %}{% endif %}
												{% set roler = "" %}{% if systeme.responsable == app.user.people or is_granted('ROLE_ADMIN')  %}{% set roler = "responsable" %}{% set roles = "suppleant" %}{% set rolep = "people" %}{% endif %}
												{% for transition in workflow_transitions(systeme) %}
													{% if workflow_can(systeme, transition.name) %}
														{% if workflow_metadata(systeme, 'role', transition) in [rolep, roles, roler] %}
															<a type="button" href="#" style="margin: 2px" class="ajaxWorkflow btn btn-{{ workflow_metadata(systeme, 'ambiance', transition)}} btn-xs adisab" data-id="{{ systeme.id }}" data-statewk="{{ transition.name }}" data-entite="systeme">
															{{ workflow_metadata(systeme, 'title', transition) ?: 'n-a'}}
															</a>
														{% endif %}
													{% endif %}
												{% else %}
													No actions available.
												{% endfor %}
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<br><br>
					
						<div class="row">
							<div class="col-lg-12">
								<div class="tabs-container">
									<ul class="nav nav-tabs">
										<li>
											<a class="nav-link active show" data-toggle="tab" href="#introduction"> 
												<span style="font-size: 18px;">
													<i class="fa fa-info-circle"></i>
												</span>
											</a>
										</li>
										{% if editMode %}
										<li>
											<a class="nav-link" data-toggle="tab" href="#docs"> 
												<span style="font-size: 18px;">
													<i class="fa fa-files-o"></i>
												</span>
											</a>
										</li>
										{% endif %}
										<li>
											<a class="nav-link" data-toggle="tab" href="#comment"> 
												<span style="font-size: 18px;">
													<i class="fa fa-pencil-square-o"></i>
												</span>
											</a>
										</li>
									</ul>
									
									<div class="tab-content">
										
										<div id="introduction" class="tab-pane active show">
											<div class="panel-body">
												<div class="row">	
													<div class="col-sm-12">
													
														<h2>Description</h2>
                                                        <br><br>
						
														<div class="form-group row"><label class="col-sm-2 col-form-label">Run</label>
                                                            <div class="col-sm-10">
                                                                <div class="row">
                                                                    <div class="col-md-5"><span class="form-text m-b-none text-navy">Etat</span>{{ form_widget(formSysteme.statutrun)}}</div>
                                                                </div>
                                                            </div>
                                                        </div>
														
                                                        <div class="form-group">
															<span class="form-text m-b-none">{{ form_label(formSysteme.role, 'Rôle') }}</span>
															{{ form_widget(formSysteme.role)}}
															<small id="" class="form-text text-muted"></small>
														</div>
												
														<div class="form-group">
															<span class="form-text m-b-none">{{ form_label(formSysteme.description, 'Description') }}</span>
															{{ form_widget(formSysteme.description)}}
															<small id="" class="form-text text-muted"></small>
														</div>
                                                        <div class="form-group row"><label class="col-sm-2 col-form-label">Type de composants</label>
                                                            <div class="col-sm-10">
                                                                <div class="row">
                                                                    <div class="col-md-3"><span class="form-text m-b-none text-navy">Type de plateforme</span>{{ form_widget(formSysteme.plateforme)}}</div>					            
                                                                    <div class="col-md-3"><span class="form-text m-b-none text-navy">Type de système</span>{{ form_widget(formSysteme.typesysteme)}}</div>
                                                                    <div class="col-md-2"><span class="form-text m-b-none text-navy">Rôle hote</span>{{ form_widget(formSysteme.srvhote)}}</div>
                                                                    <div class="col-md-2"><span class="form-text m-b-none text-navy">Haute disponibilité</span>{{ form_widget(formSysteme.replicat)}}</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                        <div class="hr-line-dashed"></div>
                                                        
                                                        <div class="form-group row"><label class="col-sm-2 col-form-label">Statut et localisation</label>
                                                            <div class="col-sm-10">
                                                                <div class="row">
                                                                    <div class="col-md-5"><span class="form-text m-b-none text-navy">Etat</span>{{ form_widget(formSysteme.statutrun)}}</div>
                                                                    <div class="col-md-5"><span class="form-text m-b-none text-navy">Localisation</span>{{ form_widget(formSysteme.localisation)}}</div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="form-group  row">
                                                            <label class="col-sm-2 col-form-label">{{ form_label(formSysteme.os, 'Système d\'exploitation') }}</label>
                                                            <div class="col-sm-10">{{ form_widget(formSysteme.os)}}</div>
                                                        </div>
                                                        
                                                        <div class="hr-line-dashed"></div>
                                                        
                                                        <div class="form-group row"><label class="col-sm-2 col-form-label">Détails de la configuration technique</label>
                                                            <div class="col-sm-10">
                                                                <div class="row">
                                                                    <div class="col-md-4"><span class="form-text m-b-none text-navy">Marque et modèle</span>{{ form_widget(formSysteme.modele)}}</div>
                                                                    <div class="col-md-4"><span class="form-text m-b-none text-navy">Processeur (Qté, Freq, etc.)</span>{{ form_widget(formSysteme.processeur)}}</div>
                                                                    <div class="col-md-4"><span class="form-text m-b-none text-navy">RAM (Qté, Freq, etc.)</span>{{ form_widget(formSysteme.ram)}}</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                                    
													
													</div>
													<div class="col-lg-12">
														<h2>Relations</h2>
                                                        <br>
    

                                                        <div class="form-group  row">
                                                            <label class="col-sm-2 col-form-label">{{ form_label(formSysteme.applications, 'Applications') }}</label>
                                                            <div class="col-sm-10">{{ form_widget(formSysteme.applications)}}</div>
                                                        </div>
                                                        
                                                        <div class="hr-line-dashed"></div>
                                                        
                                                        <div class="form-group  row">
                                                            <label class="col-sm-2 col-form-label">{{ form_label(formSysteme.systemeconnexes, 'Systèmes connexes') }}</label>
                                                            <div class="col-sm-10">{{ form_widget(formSysteme.systemeconnexes)}}</div>
                                                        </div>
                                                        
                                                        <div class="hr-line-dashed"></div>
                                                        
                                                        <div class="form-group  row">
                                                            <label class="col-sm-2 col-form-label">{{ form_label(formSysteme.host, 'Hôte virtuel') }}</label>
                                                            <div class="col-sm-10">{{ form_widget(formSysteme.host)}}</div>
                                                        </div>
                                                        
                                                        <div class="hr-line-dashed"></div>
                                                        
                                                        <div class="form-group row"><label class="col-sm-2 col-form-label">Stockage</label>
                                                            <div class="col-sm-10">
                                                                <div class="row">
                                                                    <div class="col-md-4"><span class="form-text m-b-none text-navy">Baie</span>{{ form_widget(formSysteme.storages)}}</div>
                                                                    <div class="col-md-4"><span class="form-text m-b-none text-navy">Partionnement</span>{{ form_widget(formSysteme.partitionnement)}}</div>
                                                                    <div class="col-md-4"><span class="form-text m-b-none text-navy">Raid</span>{{ form_widget(formSysteme.raid)}}</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
													</div>
                                                    <div class="col-lg-12">
														<h2>PCA</h2>
                                                        <br>
                                                        {% if editMode %}
                                                        <div class="form-group row"><label class="col-sm-2 col-form-label">Criticité</label>
                                                            <div class="col-sm-10">
                                                                <div class="row">
                                                                    <div class="col-md-3"><span class="form-text m-b-none text-navy">Secouru ?</span>{{ form_widget(formSysteme.secours)}}</div>
                                                                    <div class="col-md-8"><span class="form-text m-b-none text-navy">Evénement PCIT</span>{{ form_widget(formSysteme.PcaEvenements)}}</div>
                                                                </div>
                                                                <div class="row">
                                                                    <div class="col-md-5">
                                                                        {% set minDima = 1000 %}
                                                                            {% set desiDima = "N/C" %}
                                                                            {% set colorDima = "N/C" %}
                                                                            {% for appli in systeme.applications %}
                                                                            {% for application in appli.appConnectActivites %}
                                                                            {% if application.dima.dureeheure is not defined %}
                                                                            {% set dureHeure = "1440" %}
                                                                            {% else %}
                                                                            {% set dureHeure = application.dima.dureeheure %}
                                                                            {% endif %}	
                                                                                {% set minDima = min(dureHeure, minDima) %}
                                                                            
                                                                                {% if dureHeure == minDima %}
                                                                                    {% set desiDima = application.dima.designation %}
                                                                                    {% set colorDima = application.dima.color %}
                                                                                {% endif %}
                                                                            {% endfor %}
                                                                            {% endfor %}
                                                                        <span class="form-text m-b-none text-navy">Durée d'Indisponibilité Maximale Admissible<br>(DIMA / RTO)</span>
                                                                        <div class="widget style1 navy-bg">
                                                                            <div class="row vertical-align">
                                                                                <div class="col-3">
                                                                                    {% if minDima < 48 %}
                                                                                    <i class="fa fa-warning fa-3x"></i>
                                                                                    {% endif %}
                                                                                </div>
                                                                                <div class="col-9 text-right">
                                                                                    <span class="badge {{colorDima}}">
                                                                                    <h2 class="font-bold">{{desiDima | default("N/C")}}</h2>
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        
                                                                
                                                                        
                                                                        <ul class="list-group clear-list m-t">
                                                                        {% set minDima = 1000 %}
                                                                        {% set desiDima = "N/C" %}
                                                                        {% set colorDima = "N/C" %}					
                                                                        {% for application in systeme.applications %}
                                                                            {% for activite in application.appConnectActivites %}
                                                                            {% if activite.dima.dureeheure is not defined %}
                                                                            {% set dureHeure = "1440" %}
                                                                            {% else %}
                                                                            {% set dureHeure = activite.dima.dureeheure %}
                                                                            {% endif %}	
                                                                            {% set minDima = min(dureHeure, minDima) %}
                                                                                {% if dureHeure == minDima %}
                                                                                    {% set desiAppli = application.designation %}
                                                                                    {% set desiDima = activite.Dima.designation %}
                                                                                    {% set colorDima = activite.Dima.color %}
                                                                                {% endif %}
                                                                            
                                                                            {% endfor %}
                                                                            <li class="list-group-item">
                                                                                    <span class="float-right">
                                                                                        <span class="badge {{ colorDima }}">{{ desiDima | default("N/C") }}</span>
                                                                                    </span>
                                                                                    <a class="" href="{{path('appli_edit',{'id' : application.id} ) }}">{{ application.designation | default("N/C") }}</a>
                                                                                </li>			
                                                                        {% endfor %}
                                                                        </ul>
                                                    
                                                                    </div>
                                                                    <div class="col-md-5">
                                                                            {% set minPdma = 1000 %}
                                                                            {% set desiPdma = "N/C" %}
                                                                            {% set colorPdma = "N/C" %}
                                                                            {% for application in systeme.applications %}
                                                                            {% for activite in application.appConnectActivites %}
                                                                            {% if activite.pdma.dureeheure is not defined %}
                                                                            {% set dureHeure = "1440" %}
                                                                            {% else %}
                                                                            {% set dureHeure = activite.pdma.dureeheure %}
                                                                            {% endif %}	
                                                                                {% set minPdma = min(dureHeure, minPdma) %}
                                                                                {% if dureHeure == minPdma %}
                                                                                    {% set desiPdma = activite.Pdma.designation %}
                                                                                    {% set colorPdma = activite.Pdma.color %}
                                                                                {% endif %}
                                                                            {% endfor %}
                                                                            {% endfor %}
                                                                        
                                                                        <span class="form-text m-b-none text-navy">Perte de Données Maximale Admissible<br>(PDMA / RPO)</span>
                                                                        <div class="widget style1 navy-bg">
                                                                            <div class="row vertical-align">
                                                                                <div class="col-3">
                                                                                    {% if minPdma < 48 %}
                                                                                    <i class="fa fa-warning fa-3x"></i>
                                                                                    {% endif %}
                                                                                </div>
                                                                                <div class="col-9 text-right">
                                                                                    <span class="badge {{colorPdma}}">
                                                                                    <h2 class="font-bold">{{desiPdma | default("N/C")}}</h2>
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                
                                                                        <ul class="list-group clear-list m-t">
                                                                        {% set minPdma = 1000 %}
                                                                        {% set desiPdma = "N/C" %}
                                                                        {% set colorPdma = "N/C" %}					
                                                                        {% for application in systeme.applications %}
                                                                            {% for activite in application.appConnectActivites %}
                                                                            {% if activite.pdma.dureeheure is not defined %}
                                                                            {% set dureHeure = "1440" %}
                                                                            {% else %}
                                                                            {% set dureHeure = activite.pdma.dureeheure %}
                                                                            {% endif %}	
                                                                            {% set minPdma = min(dureHeure , minPdma) %}
                                                                                {% if dureHeure  == minPdma %}
                                                                                    {% set desiAppli = application.designation %}
                                                                                    {% set desiPdma = activite.Pdma.designation %}
                                                                                    {% set colorPdma = activite.Pdma.color %}
                                                                                {% endif %}
                                                                            
                                                                            {% endfor %}
                                                                            <li class="list-group-item">
                                                                                    <span class="float-right">
                                                                                        <span class="badge {{ colorPdma }}">{{ desiPdma | default("N/C") }}</span>
                                                                                    </span>
                                                                                    <a class="" href="{{path('appli_edit',{'id' : application.id} ) }}">{{ application.designation | default("N/C") }}</a>
                                                                                </li>			
                                                                        {% endfor %}
                                                                        </ul>
                                                    
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="hr-line-dashed"></div>
                                                        {% endif %}
                                                         <div class="row">
                                                            <div class="col-md-5"><span class="form-text m-b-none text-navy">DIMA</span>{{ form_widget(formSysteme.dima)}}</div>
                                                            <div class="col-md-5"><span class="form-text m-b-none text-navy">DIMA</span>{{ form_widget(formSysteme.pdma)}}</div>
                                                        </div>
													</div>
												</div>
											</div>
										</div>
									

										{% if editMode %}
										<div id="docs" class="tab-pane">
											<div class="panel-body">
												<div class="row">
													<div class="col-md-12"><h3>Gestionnaire de fichiers</h3></div>
												</div>
												<br>			                                
												<div class="form-group row">				
													<div class="col-sm-12">
														<iframe id="myframe" src="{{ path('file_manager', {module:1, conf:'entry', tree:0, extra: {'customer':app.user.customer.id, 'customername':app.user.customer.designation,  'bigentity': 'Systèmes', 'entryprefix': 'SYS', 'entryid': systeme.id, 'entryname': systeme .designation}}) }}" width="100%" height="500" frameborder="0"></iframe>
													</div>
												</div>
											</div>
										</div>
										{% endif %}
										<div id="comment" class="tab-pane">
											<div class="panel-body">
												<div class="row">
													<div class="col-md-12"><h3>Notes</h3></div>
												</div>
												<br>			                                
												<div class="form-group row">				
													<div class="col-sm-12">
														{{ form_widget(formSysteme.commentaire)}}
													</div>
												</div>
											</div>
										</div>

									</div>
								</div>
							</div>
						</div>						
					</div>
				</div>
			</div>
		</div>

    {{ form_end(formSysteme) }}
{% endblock %}

{% block _systeme_appConnectActivites_widget %}
	{{ form_widget(form)}}
{% endblock %}

{% block _systeme_appConnectActivites_entry_widget %}
            <div class="row" id="block_{{id}}">
	            <div class="col-md-5">{{ form_widget(form.activite)}}</div>
                <div class="col-md-2">{{ form_widget(form.dima)}}</div>
                <div class="col-md-2">{{ form_widget(form.pdma)}}</div>
                <div class="col-1">{% if is_granted('ROLE_ADMIN') or is_granted('ROLE_USER_EDITABLE') %}<button type="button" data-action="delete" data-target="#block_{{id}}" id="del-act" class="btn btn-danger btn-circle"><i class="fa fa-trash"></i></button>{% endif %}</div> 
            </div>
{% endblock %}



	
{% block javascripts %}

	<script>

	$(document).ready(function() {		
		
        
		


        
	});	


			
		
	</script>
	
{% endblock %}
	



